syntax = "proto3";
package Aevatar.Agents;

import "google/protobuf/any.proto";

// 事件传播方向
enum EventDirection {
  EVENT_DIRECTION_UNSPECIFIED = 0;
  
  // 向下发送：Parent发送到自己的stream，自动广播给所有children
  EVENT_DIRECTION_DOWN = 1;         
  
  // 向上发送：Child发送到parent的stream，自动广播给所有siblings（包括自己）
  EVENT_DIRECTION_UP = 2;           
  
  // 双向发送：同时向上和向下发送
  EVENT_DIRECTION_BOTH = 3;         
}

message MessageEnvelope {
  string id = 1;
  int64 timestamp = 2;
  google.protobuf.Any payload = 3;  // 业务Agent解析
}

message EventEnvelope {
  // 基础字段
  string id = 1;
  int64 timestamp = 2;
  int64 version = 3;  // 事件版本号
  google.protobuf.Any payload = 4;  // 事件Payload
  
  // 传播控制字段
  string correlation_id = 5;        // 关联ID，用于追踪事件链
  string publisher_id = 6;          // 发布者ID（Agent ID）
  EventDirection direction = 7;     // 传播方向
  bool should_stop_propagation = 8; // 停止传播标志
  int32 max_hop_count = 9;          // 最大跳数（-1 表示无限制）
  int32 current_hop_count = 10;     // 当前跳数
  int32 min_hop_count = 11;         // 最小跳数（-1 表示无限制）
  string message = 12;              // 附加消息（调试或日志）
  repeated string publishers = 13;  // 发布者链（按传播顺序）
  int64 published_timestamp_utc = 14; // 发布时间戳（UTC，毫秒）
}

message SubAgentAdded {
  string sub_agent_id = 1;
}

message SubAgentRemoved {
  string sub_agent_id = 1;
}

message LLMEvent {
  string prompt = 1;
  string response = 2;
}

message GeneralConfigEvent {
  string config_key = 1;
  string config_value = 2;
}

message CodeValidationEvent {
  string code = 1;
  bool result = 2;
}

message LLMAgentState {
  repeated string sub_agent_ids = 1;
  int64 current_version = 2;
  string llm_config = 3;
}

message CodingAgentState {
  repeated string sub_agent_ids = 1;
  int64 current_version = 2;
  string validation_history = 3;
}

// 异常事件
message EventHandlerExceptionEvent {
  string agent_id = 1;
  string event_id = 2;
  string handler_name = 3;
  string event_type = 4;
  string exception_message = 5;
  string stack_trace = 6;
  int64 timestamp = 7;
}

message GAgentBaseExceptionEvent {
  string agent_id = 1;
  string operation = 2;
  string exception_message = 3;
  string stack_trace = 4;
  int64 timestamp = 5;
}
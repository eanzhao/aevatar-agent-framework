# Aevatar AI Tool ç®€åŒ–è®¾è®¡

## ğŸ¯ è®¾è®¡ç›®æ ‡

åŸºäºç”¨æˆ·éœ€æ±‚ï¼Œé‡æ–°è®¾è®¡AIå·¥å…·ç³»ç»Ÿï¼Œéµå¾ªä»¥ä¸‹åŸåˆ™ï¼š
- **ç®€å•æ˜“ç”¨**ï¼šå¼€å‘è€…å¯ä»¥å¿«é€Ÿå®ç°å’Œæ³¨å†ŒAIå·¥å…·
- **çµæ´»å®ç°**ï¼šæ”¯æŒæ¥å£å®ç°å’Œå§”æ‰˜ä¸¤ç§æ–¹å¼
- **è½»é‡çº§**ï¼šå‡å°‘ä¸å¿…è¦çš„æŠ½è±¡å’Œå¤æ‚æ€§
- **æ¡†æ¶å‹å¥½**ï¼šä¸MEAIGAgentBaseæ— ç¼é›†æˆ
- **å‘½åç©ºé—´å®‰å…¨**ï¼šæ‰€æœ‰æ¥å£éƒ½å¸¦æœ‰"aevatar"å‰ç¼€é¿å…å†²çª

## ğŸ—ï¸ æ–°æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                AI Agent (MEAIGAgentBase)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  RegisterAevatarAITool() â”‚ RegisterAevatarAITool(Func<...\u003e)    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                AI Tool æŠ½è±¡å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  IAevatarAITool        â”‚ AevatarAIToolDelegate â”‚ AevatarAIToolContext â”‚   â”‚
â”‚  â”‚  (æ¥å£å®ç°)             â”‚ (å§”æ‰˜å®ç°)             â”‚ (è½»é‡çº§ä¸Šä¸‹æ–‡)        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                å·¥å…·ç®¡ç†å™¨                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  IAevatarAIToolManager  â”‚ Tool Discovery        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                å¼€å‘è€…å®ç°å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Custom Tools â”‚ Delegates    â”‚ Framework Tools  â”‚   â”‚
â”‚  â”‚ (æ¥å£å®ç°)   â”‚ (å‡½æ•°å®ç°)   â”‚ (å†…ç½®å·¥å…·)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒæ¥å£è®¾è®¡

### 1. ç®€åŒ–çš„AIå·¥å…·æ¥å£ï¼ˆå¸¦aevatarå‰ç¼€ï¼‰

```csharp
// Aevatar.Agent.AI.Abstractions
namespace Aevatar.Agents.AI.Abstractions.Tools;

public interface IAevatarAITool
{
    string Name { get; }
    string Description { get; }

    Task<AevatarAIToolResult> ExecuteAsync(
        AevatarAIToolContext context,
        Dictionary<string, object> parameters,
        CancellationToken cancellationToken = default);
}

public class AevatarAIToolResult
{
    public bool Success { get; init; }
    public object Data { get; init; }
    public string ErrorMessage { get; init; }
    public Dictionary<string, object> Metadata { get; init; } = new();

    public static AevatarAIToolResult Success(object data = null) =>
        new() { Success = true, Data = data };

    public static AevatarAIToolResult Failure(string errorMessage) =>
        new() { Success = false, ErrorMessage = errorMessage };
}
```

### 2. è½»é‡çº§å·¥å…·ä¸Šä¸‹æ–‡ï¼ˆå¸¦aevatarå‰ç¼€ï¼‰

```csharp
public class AevatarAIToolContext
{
    public string AgentId { get; init; }
    public IServiceProvider ServiceProvider { get; init; }
    public CancellationToken CancellationToken { get; init; }

    // ä»…åŒ…å«æ¡†æ¶çº§åˆ«çš„å¿…è¦ä¿¡æ¯
    public T GetService<T>() => ServiceProvider.GetRequiredService<T>();
    public T GetConfiguration<T>(string section = null) where T : class, new()
    {
        var config = ServiceProvider.GetService<IConfiguration>();
        return section != null ? config?.GetSection(section).Get<T>() ?? new T()
                              : config?.Get<T>() ?? new T();
    }
}
```

### 3. å§”æ‰˜å·¥å…·åŒ…è£…å™¨ï¼ˆå¸¦aevatarå‰ç¼€ï¼‰

```csharp
public class AevatarAIToolDelegate : IAevatarAITool
{
    private readonly Func<AevatarAIToolContext, Dictionary<string, object>, CancellationToken, Task<AevatarAIToolResult>> _executeFunc;

    public string Name { get; }
    public string Description { get; }

    public AevatarAIToolDelegate(
        string name,
        string description,
        Func<AevatarAIToolContext, Dictionary<string, object>, CancellationToken, Task<AevatarAIToolResult>> executeFunc)
    {
        Name = name;
        Description = description;
        _executeFunc = executeFunc;
    }

    public Task<AevatarAIToolResult> ExecuteAsync(
        AevatarAIToolContext context,
        Dictionary<string, object> parameters,
        CancellationToken cancellationToken = default)
    {
        return _executeFunc(context, parameters, cancellationToken);
    }
}
```

### 4. ç®€åŒ–çš„å·¥å…·ç®¡ç†å™¨ï¼ˆå¸¦aevatarå‰ç¼€ï¼‰

```csharp
public interface IAevatarAIToolManager
{
    void RegisterAevatarAITool(IAevatarAITool tool);
    void RegisterAevatarAITool(string name, string description, Func<AevatarAIToolContext, Dictionary<string, object>, CancellationToken, Task<AevatarAIToolResult>> executeFunc);

    IAevatarAITool GetAevatarAITool(string name);
    List<IAevatarAITool> GetAllAevatarAITools();
    bool AevatarAIToolExists(string name);

    Task<AevatarAIToolResult> ExecuteAevatarAIToolAsync(string toolName, AevatarAIToolContext context, Dictionary<string, object> parameters, CancellationToken cancellationToken = default);
}

public class AevatarAIToolManager : IAevatarAIToolManager
{
    private readonly ConcurrentDictionary<string, IAevatarAITool> _tools = new();
    private readonly ILogger<AevatarAIToolManager> _logger;

    public AevatarAIToolManager(ILogger<AevatarAIToolManager> logger)
    {
        _logger = logger;
    }

    public void RegisterAevatarAITool(IAevatarAITool tool)
    {
        _tools[tool.Name] = tool;
        _logger.LogInformation("Registered AI tool: {ToolName}", tool.Name);
    }

    public void RegisterAevatarAITool(string name, string description, Func<AevatarAIToolContext, Dictionary<string, object>, CancellationToken, Task<AevatarAIToolResult>> executeFunc)
    {
        var tool = new AevatarAIToolDelegate(name, description, executeFunc);
        RegisterAevatarAITool(tool);
    }

    public IAevatarAITool GetAevatarAITool(string name)
    {
        return _tools.TryGetValue(name, out var tool) ? tool : null;
    }

    public List<IAevatarAITool> GetAllAevatarAITools()
    {
        return _tools.Values.ToList();
    }

    public bool AevatarAIToolExists(string name)
    {
        return _tools.ContainsKey(name);
    }

    public async Task<AevatarAIToolResult> ExecuteAevatarAIToolAsync(string toolName, AevatarAIToolContext context, Dictionary<string, object> parameters, CancellationToken cancellationToken = default)
    {
        var tool = GetAevatarAITool(toolName);
        if (tool == null)
        {
            return AevatarAIToolResult.Failure($"AI Tool '{toolName}' not found");
        }

        try
        {
            _logger.LogDebug("Executing AI tool: {ToolName} for agent: {AgentId}", toolName, context.AgentId);
            var result = await tool.ExecuteAsync(context, parameters, cancellationToken);
            _logger.LogDebug("AI tool executed successfully: {ToolName}", toolName);
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "AI tool execution failed: {ToolName}", toolName);
            return AevatarAIToolResult.Failure($"Tool execution failed: {ex.Message}");
        }
    }
}

## ğŸš€ å¼€å‘è€…ä½¿ç”¨ä½“éªŒ

### 1. åœ¨AI Agentä¸­æ³¨å†Œå·¥å…·ï¼ˆæ¥å£æ–¹å¼ï¼‰

```csharp
public class CustomerServiceAgent : MEAIGAgentBase<CustomerServiceState>
{
    protected override void ConfigureAevatarAITools(IAevatarAIToolManager toolManager)
    {
        // æ–¹å¼1ï¼šæ³¨å†Œæ¥å£å®ç°çš„å·¥å…·
        toolManager.RegisterAevatarAITool(new DatabaseQueryTool());
        toolManager.RegisterAevatarAITool(new EmailSenderTool());

        // æ–¹å¼2ï¼šæ³¨å†Œå§”æ‰˜å®ç°çš„ç®€å•å·¥å…·ï¼ˆä¸€è¡Œä»£ç ï¼‰
        toolManager.RegisterAevatarAITool(
            "get_customer_info",
            "Get customer information from database",
            async (context, parameters, ct) =>
            {
                var customerId = parameters["customerId"]?.ToString();
                if (string.IsNullOrEmpty(customerId))
                    return AevatarAIToolResult.Failure("Customer ID is required");

                var db = context.GetService<ICustomerDatabase>();
                var customer = await db.GetCustomerAsync(customerId, ct);

                return AevatarAIToolResult.Success(customer);
            });

        // æ–¹å¼3ï¼šæ³¨å†Œå¸¦ä¸šåŠ¡é€»è¾‘çš„å¤æ‚å·¥å…·
        toolManager.RegisterAevatarAITool(
            "analyze_sentiment",
            "Analyze text sentiment using AI",
            async (context, parameters, ct) =>
            {
                var text = parameters["text"]?.ToString();
                if (string.IsNullOrEmpty(text))
                    return AevatarAIToolResult.Failure("Text is required");

                // ä½¿ç”¨AIæœåŠ¡è¿›è¡Œæƒ…æ„Ÿåˆ†æ
                var aiService = context.GetService<IAIService>();
                var sentiment = await aiService.AnalyzeSentimentAsync(text, ct);

                return AevatarAIToolResult.Success(new { sentiment, confidence = 0.85 });
            });
    }
}
```

### 2. è‡ªå®šä¹‰å·¥å…·æ¥å£å®ç°

```csharp
public class DatabaseQueryTool : IAevatarAITool
{
    public string Name => "database_query";
    public string Description => "Query customer database";

    public async Task<AevatarAIToolResult> ExecuteAsync(
        AevatarAIToolContext context,
        Dictionary<string, object> parameters,
        CancellationToken cancellationToken = default)
    {
        try
        {
            var query = parameters["query"]?.ToString();
            var parametersDict = parameters.GetValueOrDefault("parameters") as Dictionary<string, object>;

            var db = context.GetService<ICustomerDatabase>();
            var result = await db.ExecuteQueryAsync(query, parametersDict, cancellationToken);

            return AevatarAIToolResult.Success(result);
        }
        catch (Exception ex)
        {
            return AevatarAIToolResult.Failure($"Database query failed: {ex.Message}");
        }
    }
}
```

### 3. åœ¨MEAIGAgentBaseä¸­çš„é›†æˆ

```csharp
// Aevatar.Agent.AI.Core
public abstract class MEAIGAgentBase<TState> : AIGAgentBase<TState>, IMEAIAgent
{
    private IAevatarAIToolManager _toolManager;

    protected MEAIGAgentBase(
        IAevatarLLMProvider llmProvider,
        IAevatarAIToolManager toolManager,
        IAevatarMemory memory) : base(llmProvider, toolManager, memory)
    {
        _toolManager = toolManager;
        ConfigureAevatarAITools(_toolManager);
    }

    // å­ç±»é‡å†™æ­¤æ–¹æ³•æ¥æ³¨å†Œå·¥å…·
    protected virtual void ConfigureAevatarAITools(IAevatarAIToolManager toolManager)
    {
        // é»˜è®¤æ³¨å†Œä¸€äº›åŸºç¡€å·¥å…·
        toolManager.RegisterAevatarAITool(new AevatarEventPublisherTool());
        toolManager.RegisterAevatarAITool(new AevatarMemorySearchTool());
    }

    // å·¥å…·è°ƒç”¨æ–¹æ³•
    protected async Task<AevatarAIToolResult> CallAevatarAIToolAsync(
        string toolName,
        Dictionary<string, object> parameters,
        CancellationToken cancellationToken = default)
    {
        var context = new AevatarAIToolContext
        {
            AgentId = Id,
            ServiceProvider = ServiceProvider,
            CancellationToken = cancellationToken
        };

        return await _toolManager.ExecuteAevatarAIToolAsync(toolName, context, parameters, cancellationToken);
    }

    // AIå¤„ç†ä¸­çš„å·¥å…·è°ƒç”¨é›†æˆ
    protected override async Task<List<ToolExecutionResult>> ExecuteToolsAsync(
        List<ToolCall> toolCalls,
        CancellationToken cancellationToken = default)
    {
        var results = new List<ToolExecutionResult>();

        foreach (var toolCall in toolCalls)
        {
            var context = new AevatarAIToolContext
            {
                AgentId = Id,
                ServiceProvider = ServiceProvider,
                CancellationToken = cancellationToken
            };

            var result = await _toolManager.ExecuteAevatarAIToolAsync(
                toolCall.Name,
                context,
                toolCall.Parameters,
                cancellationToken);

            results.Add(new ToolExecutionResult(toolCall, result));
        }

        return results;
    }
}
```

## ğŸ› ï¸ æ¡†æ¶å†…ç½®å·¥å…·

### 1. äº‹ä»¶å‘å¸ƒå·¥å…·

```csharp
public class AevatarEventPublisherTool : IAevatarAITool
{
    public string Name => "publish_event";
    public string Description => "Publish events to the agent hierarchy";

    public async Task<AevatarAIToolResult> ExecuteAsync(
        AevatarAIToolContext context,
        Dictionary<string, object> parameters,
        CancellationToken cancellationToken = default)
    {
        try
        {
            var eventType = parameters["eventType"]?.ToString();
            var eventData = parameters["eventData"];

            if (string.IsNullOrEmpty(eventType))
                return AevatarAIToolResult.Failure("Event type is required");

            // åˆ›å»ºäº‹ä»¶å®ä¾‹
            var eventInstance = CreateEventInstance(eventType, eventData);
            if (eventInstance == null)
                return AevatarAIToolResult.Failure($"Invalid event type: {eventType}");

            // å‘å¸ƒäº‹ä»¶
            var publisher = context.GetService<IEventPublisher>();
            var direction = Enum.Parse<EventDirection>(
                parameters.GetValueOrDefault("direction")?.ToString() ?? "Bidirectional");

            await publisher.PublishAsync(eventInstance, direction);

            return AevatarAIToolResult.Success(new { published = true, eventType });
        }
        catch (Exception ex)
        {
            return AevatarAIToolResult.Failure($"Failed to publish event: {ex.Message}");
        }
    }

    private IEvent CreateEventInstance(string eventType, object eventData)
    {
        // ä½¿ç”¨åå°„æˆ–å·¥å‚æ¨¡å¼åˆ›å»ºäº‹ä»¶å®ä¾‹
        var eventTypeInfo = Type.GetType(eventType);
        if (eventTypeInfo == null) return null;

        return JsonSerializer.Deserialize(
            JsonSerializer.Serialize(eventData),
            eventTypeInfo) as IEvent;
    }
}
```

### 2. å†…å­˜æœç´¢å·¥å…·

```csharp
public class AevatarMemorySearchTool : IAevatarAITool
{
    public string Name => "search_memory";
    public string Description => "Search agent memory for relevant information";

    public async Task<AevatarAIToolResult> ExecuteAsync(
        AevatarAIToolContext context,
        Dictionary<string, object> parameters,
        CancellationToken cancellationToken = default)
    {
        try
        {
            var query = parameters["query"]?.ToString();
            var maxResults = Convert.ToInt32(parameters.GetValueOrDefault("maxResults", 10));

            if (string.IsNullOrEmpty(query))
                return AevatarAIToolResult.Failure("Search query is required");

            var memory = context.GetService<IAevatarMemory>();
            var results = await memory.SearchLongTermMemoryAsync(
                context.AgentId, query, maxResults);

            return AevatarAIToolResult.Success(new
            {
                results,
                count = results.Count,
                query
            });
        }
        catch (Exception ex)
        {
            return AevatarAIToolResult.Failure($"Memory search failed: {ex.Message}");
        }
    }
}
```

## ğŸ”§ æœåŠ¡æ³¨å†Œ

```csharp
public static class ServiceCollectionExtensions
{
    public static IServiceCollection AddAevatarAITools(this IServiceCollection services)
    {
        // æ³¨å†Œå·¥å…·ç®¡ç†å™¨
        services.AddSingleton<IAevatarAIToolManager, AevatarAIToolManager>();

        // æ³¨å†Œå†…ç½®å·¥å…·
        services.AddTransient<AevatarEventPublisherTool>();
        services.AddTransient<AevatarMemorySearchTool>();

        return services;
    }

    // æ‰©å±•æ–¹æ³•ï¼šå…è®¸å¼€å‘è€…æ³¨å†Œè‡ªå®šä¹‰å·¥å…·
    public static IServiceCollection AddCustomAevatarAITool<TTool>(this IServiceCollection services)
        where TTool : class, IAevatarAITool
    {
        services.AddTransient<IAevatarAITool, TTool>();
        return services;
    }
}
```

## ğŸ”„ ä¸ç°æœ‰ä»£ç çš„è¿ç§»æ–¹æ¡ˆ

### 1. å…¼å®¹ç°æœ‰æ¥å£

```csharp
// åœ¨ç°æœ‰çš„IAevatarToolæ¥å£ä¸Šæ·»åŠ é€‚é…å™¨
public class AevatarToolAdapter : IAevatarAITool
{
    private readonly IAevatarTool _legacyTool;

    public AevatarToolAdapter(IAevatarTool legacyTool)
    {
        _legacyTool = legacyTool;
    }

    public string Name => _legacyTool.Name;
    public string Description => _legacyTool.Description;

    public async Task<AevatarAIToolResult> ExecuteAsync(
        AevatarAIToolContext context,
        Dictionary<string, object> parameters,
        CancellationToken cancellationToken = default)
    {
        // é€‚é…æ—§æ¥å£åˆ°æ–°æ¥å£
        var legacyContext = new ToolContext(
            context.AgentId,
            context.ServiceProvider,
            null,
            cancellationToken);

        var result = await _legacyTool.ExecuteAsync(parameters, cancellationToken);

        return new AevatarAIToolResult
        {
            Success = result.Success,
            Data = result.Data,
            ErrorMessage = result.ErrorMessage,
            Metadata = result.Metadata
        };
    }
}
```

### 2. é€æ­¥è¿ç§»å»ºè®®

1. **ä¿æŒç°æœ‰æ¥å£ä¸å˜**ï¼šç°æœ‰çš„`IAevatarTool`å’Œå®ç°ç»§ç»­å·¥ä½œ
2. **æä¾›é€‚é…å™¨**ï¼šé€šè¿‡é€‚é…å™¨æ¨¡å¼å°†æ—§å·¥å…·è½¬æ¢ä¸ºæ–°æ¥å£
3. **æ¨èæ–°æ¥å£**ï¼šæ–°å¼€å‘å»ºè®®ä½¿ç”¨`IAevatarAITool`æ¥å£
4. **æœ€ç»ˆæ›¿æ¢**ï¼šåœ¨ä¸»è¦ç‰ˆæœ¬æ›´æ–°æ—¶å®Œå…¨è¿ç§»åˆ°æ–°æ¥å£

## ğŸ“š æ€»ç»“

### æ–°è®¾è®¡çš„ä¼˜åŠ¿ï¼š

1. **å‘½åç©ºé—´å®‰å…¨**ï¼šæ‰€æœ‰æ¥å£éƒ½å¸¦æœ‰"aevatar"å‰ç¼€ï¼Œé¿å…å‘½åå†²çª
2. **ç®€å•æ˜“ç”¨**ï¼šå¼€å‘è€…åªéœ€å®ç°ä¸€ä¸ªç®€å•çš„`IAevatarAITool`æ¥å£
3. **çµæ´»å®ç°**ï¼šæ”¯æŒæ¥å£å®ç°å’Œå§”æ‰˜ä¸¤ç§æ–¹å¼
4. **è½»é‡çº§**ï¼šå‡å°‘äº†å¤æ‚çš„éªŒè¯å’Œæƒé™ç³»ç»Ÿ
5. **æ— ç¼é›†æˆ**ï¼šä¸MEAIGAgentBaseå®Œç¾é›†æˆï¼Œæä¾›`ConfigureAevatarAITools()`æ–¹æ³•
6. **å‘åå…¼å®¹**ï¼šæä¾›é€‚é…å™¨æ”¯æŒç°æœ‰ä»£ç 

### å¼€å‘è€…ç°åœ¨å¯ä»¥ï¼š

- ä½¿ç”¨`ConfigureAevatarAITools()`æ–¹æ³•åœ¨AI Agentä¸­æ³¨å†Œå·¥å…·
- é€šè¿‡å§”æ‰˜å¿«é€Ÿåˆ›å»ºç®€å•å·¥å…·ï¼ˆä¸€è¡Œä»£ç ï¼‰
- å®ç°æ¥å£åˆ›å»ºå¤æ‚çš„å·¥å…·
- è®¿é—®æ¡†æ¶æä¾›çš„åŸºç¡€åŠŸèƒ½ï¼ˆäº‹ä»¶ã€å†…å­˜ã€é…ç½®ç­‰ï¼‰
- ä¿æŒä¸ç°æœ‰ä»£ç çš„å…¼å®¹æ€§

è¿™ä¸ªè®¾è®¡æ—¢æ»¡è¶³äº†ç®€åŒ–éœ€æ±‚ï¼Œåˆä¿æŒäº†ä¸ç°æœ‰ä»£ç çš„å…¼å®¹æ€§ï¼ŒåŒæ—¶é€šè¿‡å‘½åç©ºé—´å‰ç¼€é¿å…äº†æ½œåœ¨çš„å‘½åå†²çªã€‚

## ğŸš€ å¼€å‘è€…ä½¿ç”¨ä½“éªŒ

### 1. åœ¨AI Agentä¸­æ³¨å†Œå·¥å…·ï¼ˆæ¥å£æ–¹å¼ï¼‰

```csharp
public class CustomerServiceAgent : MEAIGAgentBase<CustomerServiceState>
{
    protected override void ConfigureAITools(IAIToolManager toolManager)
    {
        // æ–¹å¼1ï¼šæ³¨å†Œæ¥å£å®ç°çš„å·¥å…·
        toolManager.RegisterTool(new DatabaseQueryTool());
        toolManager.RegisterTool(new EmailSenderTool());

        // æ–¹å¼2ï¼šæ³¨å†Œå§”æ‰˜å®ç°çš„ç®€å•å·¥å…·
        toolManager.RegisterTool(
            "get_customer_info",
            "Get customer information from database",
            async (context, parameters, ct) =>
            {
                var customerId = parameters["customerId"]?.ToString();
                if (string.IsNullOrEmpty(customerId))
                    return AIToolResult.Failure("Customer ID is required");

                var db = context.GetService<ICustomerDatabase>();
                var customer = await db.GetCustomerAsync(customerId, ct);

                return AIToolResult.Success(customer);
            });

        // æ–¹å¼3ï¼šæ³¨å†Œå¸¦ä¸šåŠ¡é€»è¾‘çš„å¤æ‚å·¥å…·
        toolManager.RegisterTool(
            "analyze_sentiment",
            "Analyze text sentiment using AI",
            async (context, parameters, ct) =>
            {
                var text = parameters["text"]?.ToString();
                if (string.IsNullOrEmpty(text))
                    return AIToolResult.Failure("Text is required");

                // ä½¿ç”¨AIæœåŠ¡è¿›è¡Œæƒ…æ„Ÿåˆ†æ
                var aiService = context.GetService<IAIService>();
                var sentiment = await aiService.AnalyzeSentimentAsync(text, ct);

                return AIToolResult.Success(new { sentiment, confidence = 0.85 });
            });
    }
}
```

### 2. è‡ªå®šä¹‰å·¥å…·æ¥å£å®ç°

```csharp
public class DatabaseQueryTool : IAITool
{
    public string Name => "database_query";
    public string Description => "Query customer database";

    public async Task<AIToolResult> ExecuteAsync(
        AIToolContext context,
        Dictionary<string, object> parameters,
        CancellationToken cancellationToken = default)
    {
        try
        {
            var query = parameters["query"]?.ToString();
            var parametersDict = parameters.GetValueOrDefault("parameters") as Dictionary<string, object>;

            var db = context.GetService<ICustomerDatabase>();
            var result = await db.ExecuteQueryAsync(query, parametersDict, cancellationToken);

            return AIToolResult.Success(result);
        }
        catch (Exception ex)
        {
            return AIToolResult.Failure($"Database query failed: {ex.Message}");
        }
    }
}
```

### 3. åœ¨AIGAgentBaseä¸­çš„é›†æˆ

```csharp
// Aevatar.Agent.AI.Core
public abstract class AIGAgentBase<TState> : GAgentBase<TState>, IAIGAgent
{
    private IAIToolManager _toolManager;

    protected AIGAgentBase(
        IAevatarLLMProvider llmProvider,
        IAevatarToolManager toolManager,
        IAevatarMemory memory) : base()
    {
        _toolManager = toolManager;
        ConfigureAITools(_toolManager);
    }

    // å­ç±»é‡å†™æ­¤æ–¹æ³•æ¥æ³¨å†Œå·¥å…·
    protected virtual void ConfigureAITools(IAIToolManager toolManager)
    {
        // é»˜è®¤æ³¨å†Œä¸€äº›åŸºç¡€å·¥å…·
        toolManager.RegisterTool(new EventPublisherTool());
        toolManager.RegisterTool(new MemorySearchTool());
    }

    // å·¥å…·è°ƒç”¨æ–¹æ³•
    protected async Task<AIToolResult> CallToolAsync(
        string toolName,
        Dictionary<string, object> parameters,
        CancellationToken cancellationToken = default)
    {
        var context = new AIToolContext
        {
            AgentId = Id,
            ServiceProvider = ServiceProvider,
            CancellationToken = cancellationToken
        };

        return await _toolManager.ExecuteToolAsync(toolName, context, parameters, cancellationToken);
    }

    // AIå¤„ç†ä¸­çš„å·¥å…·è°ƒç”¨é›†æˆ
    protected override async Task<List<ToolCall>> FilterToolCallsAsync(
        List<ToolCall> toolCalls,
        AIContext context)
    {
        // ç®€åŒ–çš„å·¥å…·è°ƒç”¨è¿‡æ»¤é€»è¾‘
        var availableTools = _toolManager.GetAllTools().Select(t => t.Name).ToHashSet();

        return toolCalls.Where(call => availableTools.Contains(call.Name)).ToList();
    }

    protected override async Task<List<ToolExecutionResult>> ExecuteToolsAsync(
        List<ToolCall> toolCalls,
        CancellationToken cancellationToken = default)
    {
        var results = new List<ToolExecutionResult>();

        foreach (var toolCall in toolCalls)
        {
            var context = new AIToolContext
            {
                AgentId = Id,
                ServiceProvider = ServiceProvider,
                CancellationToken = cancellationToken
            };

            var result = await _toolManager.ExecuteToolAsync(
                toolCall.Name,
                context,
                toolCall.Parameters,
                cancellationToken);

            results.Add(new ToolExecutionResult(toolCall, result));
        }

        return results;
    }
}
```

## ğŸ› ï¸ æ¡†æ¶å†…ç½®å·¥å…·

### 1. äº‹ä»¶å‘å¸ƒå·¥å…·

```csharp
public class EventPublisherTool : IAITool
{
    public string Name => "publish_event";
    public string Description => "Publish events to the agent hierarchy";

    public async Task<AIToolResult> ExecuteAsync(
        AIToolContext context,
        Dictionary<string, object> parameters,
        CancellationToken cancellationToken = default)
    {
        try
        {
            var eventType = parameters["eventType"]?.ToString();
            var eventData = parameters["eventData"];

            if (string.IsNullOrEmpty(eventType))
                return AIToolResult.Failure("Event type is required");

            // åˆ›å»ºäº‹ä»¶å®ä¾‹
            var eventInstance = CreateEventInstance(eventType, eventData);
            if (eventInstance == null)
                return AIToolResult.Failure($"Invalid event type: {eventType}");

            // å‘å¸ƒäº‹ä»¶
            var publisher = context.GetService<IEventPublisher>();
            var direction = Enum.Parse<EventDirection>(
                parameters.GetValueOrDefault("direction")?.ToString() ?? "Bidirectional");

            await publisher.PublishAsync(eventInstance, direction);

            return AIToolResult.Success(new { published = true, eventType });
        }
        catch (Exception ex)
        {
            return AIToolResult.Failure($"Failed to publish event: {ex.Message}");
        }
    }

    private IEvent CreateEventInstance(string eventType, object eventData)
    {
        // ä½¿ç”¨åå°„æˆ–å·¥å‚æ¨¡å¼åˆ›å»ºäº‹ä»¶å®ä¾‹
        var eventTypeInfo = Type.GetType(eventType);
        if (eventTypeInfo == null) return null;

        return JsonSerializer.Deserialize(
            JsonSerializer.Serialize(eventData),
            eventTypeInfo) as IEvent;
    }
}
```

### 2. å†…å­˜æœç´¢å·¥å…·

```csharp
public class MemorySearchTool : IAITool
{
    public string Name => "search_memory";
    public string Description => "Search agent memory for relevant information";

    public async Task<AIToolResult> ExecuteAsync(
        AIToolContext context,
        Dictionary<string, object> parameters,
        CancellationToken cancellationToken = default)
    {
        try
        {
            var query = parameters["query"]?.ToString();
            var maxResults = Convert.ToInt32(parameters.GetValueOrDefault("maxResults", 10));

            if (string.IsNullOrEmpty(query))
                return AIToolResult.Failure("Search query is required");

            var memory = context.GetService<IAevatarMemory>();
            var results = await memory.SearchLongTermMemoryAsync(
                context.AgentId, query, maxResults);

            return AIToolResult.Success(new
            {
                results,
                count = results.Count,
                query
            });
        }
        catch (Exception ex)
        {
            return AIToolResult.Failure($"Memory search failed: {ex.Message}");
        }
    }
}
```

## ğŸ”§ æœåŠ¡æ³¨å†Œ

```csharp
public static class ServiceCollectionExtensions
{
    public static IServiceCollection AddAITools(this IServiceCollection services)
    {
        // æ³¨å†Œå·¥å…·ç®¡ç†å™¨
        services.AddSingleton<IAIToolManager, AIToolManager>();

        // æ³¨å†Œå†…ç½®å·¥å…·
        services.AddTransient<EventPublisherTool>();
        services.AddTransient<MemorySearchTool>();

        return services;
    }

    // æ‰©å±•æ–¹æ³•ï¼šå…è®¸å¼€å‘è€…æ³¨å†Œè‡ªå®šä¹‰å·¥å…·
    public static IServiceCollection AddCustomAITool<TTool>(this IServiceCollection services)
        where TTool : class, IAITool
    {
        services.AddTransient<IAITool, TTool>();
        return services;
    }
}
```

## ğŸ“š æ€»ç»“

### æ–°è®¾è®¡çš„ä¼˜åŠ¿ï¼š

1. **ç®€å•æ˜“ç”¨**ï¼š
   - å¼€å‘è€…åªéœ€å®ç°ä¸€ä¸ªç®€å•çš„`IAITool`æ¥å£
   - æ”¯æŒå§”æ‰˜æ–¹å¼ï¼Œæ— éœ€åˆ›å»ºç±»
   - ä¸€è¡Œä»£ç å³å¯æ³¨å†Œå·¥å…·

2. **è½»é‡çº§**ï¼š
   - å‡å°‘äº†å¤æ‚çš„éªŒè¯å’Œæƒé™ç³»ç»Ÿ
   - ç®€åŒ–çš„å·¥å…·ä¸Šä¸‹æ–‡ï¼ŒåªåŒ…å«å¿…è¦ä¿¡æ¯
   - æ›´å°‘çš„æŠ½è±¡å±‚æ¬¡

3. **çµæ´»æ€§**ï¼š
   - æ¥å£å®ç°å’Œå§”æ‰˜ä¸¤ç§æ–¹å¼
   - å·¥å…·å‚æ•°è‡ªç”±å®šä¹‰
   - æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥æ‰§è¡Œ

4. **æ¡†æ¶é›†æˆ**ï¼š
   - ä¸MEAIGAgentBaseæ— ç¼é›†æˆ
   - å†…ç½®åŸºç¡€å·¥å…·ï¼ˆäº‹ä»¶å‘å¸ƒã€å†…å­˜æœç´¢ç­‰ï¼‰
   - è‡ªåŠ¨å·¥å…·å‘ç°å’Œæ³¨å†Œ

5. **æ‰©å±•æ€§**ï¼š
   - æ˜“äºæ·»åŠ æ–°çš„å†…ç½®å·¥å…·
   - æ”¯æŒè‡ªå®šä¹‰å·¥å…·æ³¨å†Œ
   - æœåŠ¡å®¹å™¨é›†æˆ

è¿™ä¸ªç®€åŒ–è®¾è®¡è®©å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºå·¥å…·çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸æ˜¯å¤æ‚çš„æ¡†æ¶é…ç½®ï¼ŒåŒæ—¶ä¿æŒäº†å¿…è¦çš„åŠŸèƒ½å’Œæ‰©å±•æ€§ã€‚æ¡†æ¶çº§åˆ«çš„å®‰å…¨æ€§å’ŒéªŒè¯å¯ä»¥åœ¨æ›´é«˜å±‚å¤„ç†ã€‚å¼€å‘è€…ç°åœ¨å¯ä»¥ï¼š

- å¿«é€Ÿåˆ›å»ºç®€å•çš„å§”æ‰˜å·¥å…·
- å®ç°æ¥å£åˆ›å»ºå¤æ‚çš„å·¥å…·
- åœ¨AI Agentä¸­è½»æ¾æ³¨å†Œå’Œä½¿ç”¨å·¥å…·
- è®¿é—®æ¡†æ¶æä¾›çš„åŸºç¡€åŠŸèƒ½ï¼ˆäº‹ä»¶ã€å†…å­˜ã€é…ç½®ç­‰ï¼‰